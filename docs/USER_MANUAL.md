# LAN Music Sync 用户手册

## 目录

1. [简介](#简介)
2. [系统要求](#系统要求)
3. [安装指南](#安装指南)
4. [快速开始](#快速开始)
5. [功能详解](#功能详解)
6. [故障排除](#故障排除)
7. [常见问题](#常见问题)
8. [技术支持](#技术支持)

## 简介

LAN Music Sync 是一款创新的安卓音乐同步播放应用，让您能够在多台设备上同时播放音乐，创造完美的多房间音响体验。无论是家庭聚会、办公室背景音乐，还是朋友聚会，都能让所有人享受同步的音乐体验。

### 主要特性

**多设备同步播放**：支持一台主设备控制，多台从设备同步播放，实现真正的多房间音响效果。

**Wi-Fi Direct 连接**：采用先进的 Wi-Fi Direct 技术，无需路由器即可建立设备间的直接连接，确保稳定可靠的通信。

**低延迟同步**：优化的音频同步算法，确保所有设备的播放延迟控制在 50-100 毫秒以内，提供近乎完美的同步体验。

**现代化界面**：采用 Google Material Design 3 设计规范，提供直观美观的用户界面，操作简单易懂。

**智能设备发现**：自动发现局域网内的其他设备，简化连接过程，让用户专注于享受音乐。



## 系统要求

### 硬件要求

**Android 设备**：运行 Android 7.0 (API 级别 24) 或更高版本的智能手机或平板电脑。这个版本要求确保了应用能够充分利用现代 Android 系统的功能和安全特性。

**Wi-Fi Direct 支持**：设备必须支持 Wi-Fi Direct 功能。大多数 2015 年后生产的 Android 设备都内置了这项技术。您可以在设备的 Wi-Fi 设置中查看是否有"Wi-Fi Direct"选项来确认支持情况。

**存储空间**：至少需要 50MB 的可用存储空间用于安装应用，另外建议预留额外空间用于音乐文件和缓存数据。

**内存要求**：建议设备具有至少 2GB RAM，以确保应用在多设备同步时的流畅运行。

### 网络要求

**Wi-Fi 连接**：虽然应用主要使用 Wi-Fi Direct 进行设备间通信，但建议所有设备都连接到同一个 Wi-Fi 网络，这样可以提高设备发现的成功率和连接稳定性。

**网络带宽**：每台设备建议至少具有 1Mbps 的网络带宽，以确保音频数据的流畅传输。对于高质量音频，建议使用 5Mbps 或更高的带宽。

### 权限要求

应用需要以下系统权限才能正常工作：

**位置权限**：Android 系统要求应用在使用 Wi-Fi Direct 功能时必须获得位置权限。这是系统级别的安全要求，应用本身不会收集或使用您的位置信息。

**网络权限**：用于建立设备间的网络连接和数据传输。

**存储权限**：用于读取设备上的音乐文件。在 Android 13 及以上版本中，这被细分为媒体文件访问权限。

**前台服务权限**：确保音乐播放服务能够在后台持续运行，即使应用不在前台也能保持同步播放。

## 安装指南

### 从 GitHub Releases 安装

**步骤一：下载 APK 文件**

访问项目的 GitHub Releases 页面，下载最新版本的 APK 文件。文件名通常为 `LanMusicSync-v1.0.0.apk` 的格式。

**步骤二：启用未知来源安装**

由于应用不是从 Google Play Store 下载，您需要在设备设置中允许从未知来源安装应用。具体步骤因 Android 版本而异：

Android 8.0 及以上版本：进入"设置" > "安全" > "未知来源"，为您使用的文件管理器或浏览器启用安装权限。

Android 7.x 及以下版本：进入"设置" > "安全" > "未知来源"，启用该选项。

**步骤三：安装应用**

使用文件管理器找到下载的 APK 文件，点击进行安装。系统会显示应用所需的权限列表，确认后即可完成安装。

### 从源代码构建

如果您希望从源代码构建应用，请参考项目根目录下的 `CONTRIBUTING.md` 文件中的开发环境设置说明。

### 验证安装

安装完成后，您可以在应用抽屉中找到"LAN Music Sync"图标。首次启动时，应用会请求必要的权限，请务必全部授予以确保功能正常。


## 快速开始

### 第一次使用

**准备工作**

确保所有要参与音乐同步的设备都已安装 LAN Music Sync 应用，并且都连接到同一个 Wi-Fi 网络。虽然应用使用 Wi-Fi Direct 进行直接通信，但连接到同一网络有助于提高设备发现的成功率。

在开始之前，请确保所有设备都已授予应用所需的权限，特别是位置权限和存储权限。这些权限对于设备发现和音乐文件访问是必需的。

**选择主设备**

在多设备音乐同步中，需要指定一台设备作为主设备（Host），负责控制音乐播放和管理连接的从设备。建议选择以下特征的设备作为主设备：

性能较好的设备，具有充足的处理能力和内存，能够同时处理音乐播放和多设备通信。

电池电量充足或可以连接电源，因为主设备需要持续运行以维持与所有从设备的连接。

存储有音乐文件的设备，或者能够方便访问音乐资源的设备。

网络信号较好的位置，确保能够稳定地与所有从设备通信。

### 创建音乐房间（主设备操作）

**启动主设备模式**

在选定的主设备上打开 LAN Music Sync 应用。在主界面上，您会看到两个主要选项："创建主设备"和"加入主设备"。点击"创建主设备"按钮开始设置音乐房间。

系统会弹出一个对话框，要求您输入设备名称。这个名称将显示给其他想要连接的设备，建议使用易于识别的名称，如"客厅音响"、"小明的手机"等。输入名称后点击"确定"。

**等待设备连接**

成功创建主设备后，应用会自动切换到主设备控制界面。在这个界面上，您可以看到"等待设备连接..."的提示，以及一个显示已连接设备的列表。

此时，主设备已经开始广播自己的存在，其他设备可以发现并连接到这个音乐房间。主设备会持续运行设备发现服务，直到您手动停止或关闭应用。

**管理连接的设备**

当有从设备成功连接时，它们会出现在"已连接设备"列表中。您可以看到每个设备的名称、连接状态和连接时间。如果需要，您可以点击设备名称查看更详细的连接信息，或者选择断开特定设备的连接。

### 加入音乐房间（从设备操作）

**搜索可用的主设备**

在要作为从设备的设备上打开 LAN Music Sync 应用，点击主界面上的"加入主设备"按钮。应用会自动开始搜索局域网内可用的音乐房间。

搜索过程通常需要几秒钟到一分钟的时间，具体取决于网络环境和设备数量。在搜索过程中，您会看到"搜索主设备..."的提示和一个旋转的加载指示器。

**连接到主设备**

当搜索完成后，应用会显示发现的可用主设备列表。每个主设备会显示其设备名称、IP 地址和信号强度。选择您想要连接的主设备，点击"连接"按钮。

连接过程可能需要几秒钟的时间。成功连接后，从设备界面会显示"已连接到 [主设备名称]"的状态，并且会显示当前的播放状态和控制选项。

**同步播放体验**

一旦从设备成功连接到主设备，它就会自动同步主设备的播放状态。这意味着当主设备开始播放音乐时，从设备也会同时开始播放相同的音乐，并且保持同步。

从设备可以看到当前播放的歌曲信息、播放进度和音量设置，但大部分控制操作需要在主设备上进行。从设备主要负责接收和播放音频数据，确保与主设备保持同步。


## 功能详解

### 音乐播放控制

**基本播放控制**

主设备提供完整的音乐播放控制功能，包括播放、暂停、停止、上一首和下一首。这些控制操作会实时同步到所有连接的从设备，确保所有设备保持一致的播放状态。

播放按钮用于开始或恢复音乐播放。当您点击播放时，主设备会立即开始播放选定的音乐，同时向所有从设备发送播放命令和音频数据流。

暂停功能允许您临时停止音乐播放，保持当前播放位置。再次点击播放时，音乐会从暂停的位置继续播放，所有设备都会保持同步。

停止功能会完全停止音乐播放并重置播放位置到歌曲开头。这对于切换到不同的音乐或结束播放会话很有用。

**音量控制**

应用提供统一的音量控制功能，主设备上的音量调节会同步到所有从设备。这确保了整个音乐系统的音量保持一致，创造和谐的听音体验。

您可以通过主设备界面上的音量滑块来调节整体音量，也可以使用设备的物理音量键。音量变化会实时传输到所有从设备，通常延迟不超过 100 毫秒。

需要注意的是，每台设备的最大音量仍然受到其硬件限制和系统音量设置的约束。应用的音量控制是在系统音量基础上的相对调节。

**播放进度控制**

主设备可以控制音乐的播放进度，包括快进、快退和跳转到特定位置。这些操作会同步到所有从设备，确保所有设备播放相同的音乐片段。

进度条显示当前播放位置和歌曲总长度。您可以拖动进度条上的滑块来跳转到歌曲的任意位置。跳转操作会立即同步到所有从设备。

### 设备管理

**设备发现机制**

应用使用先进的设备发现机制来自动识别局域网内的其他 LAN Music Sync 设备。这个过程结合了 Wi-Fi Direct 技术和网络广播，确保快速准确的设备发现。

主设备会定期广播自己的存在信息，包括设备名称、IP 地址和服务端口。从设备通过监听这些广播信息来发现可用的主设备。

发现过程是双向的，主设备也会主动搜索想要连接的从设备，这提高了连接成功率，特别是在复杂的网络环境中。

**连接管理**

一旦设备之间建立连接，应用会持续监控连接状态，确保通信的稳定性。如果检测到连接中断，系统会自动尝试重新连接。

连接管理包括心跳检测机制，定期在设备间发送小的状态包来验证连接是否正常。如果某个设备在指定时间内没有响应，系统会将其标记为离线并尝试重新连接。

主设备可以管理多个从设备的连接，支持最多 8 台设备同时连接。每个连接都是独立管理的，一个设备的连接问题不会影响其他设备的正常工作。

**设备状态监控**

应用提供实时的设备状态监控功能，让您可以随时了解每个连接设备的状态。状态信息包括连接质量、网络延迟、音频缓冲状态等。

在主设备的设备列表中，每个从设备都会显示其当前状态：绿色表示连接正常，黄色表示连接不稳定，红色表示连接中断。这些视觉指示器帮助您快速识别可能的问题。

### 音频同步技术

**时间同步机制**

为了实现精确的音频同步，应用实现了复杂的时间同步机制。这个机制确保所有设备使用相同的时间基准，从而实现毫秒级的播放同步。

系统使用网络时间协议（NTP）的简化版本来同步设备间的时钟。主设备作为时间服务器，定期向从设备发送时间同步信息。

每个音频数据包都包含精确的时间戳，指示该数据应该在什么时候播放。从设备根据这些时间戳来调整自己的播放时机，确保与主设备保持同步。

**缓冲管理**

应用使用智能缓冲管理来处理网络延迟和抖动。每个从设备维护一个音频缓冲区，预先存储一定量的音频数据，以应对网络传输的不稳定性。

缓冲区大小会根据网络条件动态调整。在网络状况良好时，缓冲区较小以减少延迟；在网络不稳定时，缓冲区增大以提供更好的容错能力。

系统持续监控每个设备的缓冲状态，如果某个设备的缓冲区即将耗尽，会优先向该设备发送音频数据，确保播放不会中断。

**延迟补偿**

由于网络传输和设备处理的延迟，不同设备之间可能存在微小的播放时间差。应用实现了自动延迟补偿机制来解决这个问题。

系统会测量每个设备的网络延迟和音频处理延迟，然后相应地调整音频数据的发送时间和播放时间。这确保所有设备的音频输出在物理上保持同步。

延迟补偿是动态进行的，系统会持续监控和调整，以适应变化的网络条件和设备性能。


## 故障排除

### 连接问题

**无法发现其他设备**

如果您的设备无法发现其他 LAN Music Sync 设备，请按照以下步骤进行排查：

首先确认所有设备都连接到同一个 Wi-Fi 网络。虽然应用使用 Wi-Fi Direct 进行直接通信，但连接到同一网络有助于设备发现过程。

检查设备的 Wi-Fi Direct 功能是否正常工作。您可以在设备的 Wi-Fi 设置中查找"Wi-Fi Direct"选项，确保该功能已启用。

验证应用是否已获得所有必要的权限，特别是位置权限。在 Android 设置中进入"应用管理" > "LAN Music Sync" > "权限"，确保所有权限都已授予。

尝试重启设备的 Wi-Fi 功能。关闭 Wi-Fi，等待几秒钟后重新开启，然后重新启动应用的设备发现功能。

如果问题持续存在，尝试重启应用或重启设备。有时系统资源的临时问题可能影响网络功能的正常工作。

**连接频繁中断**

如果设备间的连接经常中断，可能的原因和解决方案包括：

检查网络环境的稳定性。如果 Wi-Fi 信号较弱或网络拥塞，可能导致连接不稳定。尝试将设备移动到信号更强的位置，或者减少网络上的其他活动。

确保设备有足够的电量。当设备电量过低时，系统可能会限制网络活动以节省电力，这可能影响连接稳定性。

检查是否有其他应用在大量使用网络资源。关闭不必要的网络应用，为 LAN Music Sync 提供更多的网络带宽。

在设备的电池优化设置中，将 LAN Music Sync 设置为"不优化"，防止系统在后台限制应用的网络活动。

**音频同步问题**

如果音频在不同设备上不同步，请尝试以下解决方案：

检查所有设备的系统时间是否正确。虽然应用有自己的时间同步机制，但系统时间的大幅偏差可能影响同步效果。

确保所有设备的性能足够处理音频同步。较老或性能较低的设备可能在处理音频数据时出现延迟。

检查网络延迟。使用网络测试工具检查设备间的网络延迟，如果延迟过高（超过 200 毫秒），可能需要改善网络环境。

尝试降低音频质量设置。在应用设置中选择较低的音频质量，可以减少网络带宽需求和处理延迟。

### 性能问题

**应用运行缓慢**

如果应用运行缓慢或响应迟钝，可能的原因和解决方案：

检查设备的可用内存。关闭其他不必要的应用，为 LAN Music Sync 释放更多内存资源。

清理应用缓存。在 Android 设置中进入"应用管理" > "LAN Music Sync" > "存储"，点击"清除缓存"。

确保设备有足够的存储空间。系统存储空间不足可能影响应用性能。

检查设备是否过热。过热可能导致系统降频，影响应用性能。让设备冷却后再使用。

**音频播放卡顿**

如果音频播放出现卡顿或中断，请尝试：

检查网络连接质量。使用网络速度测试工具确认网络带宽是否足够。

降低同时连接的设备数量。如果连接了太多设备，可能超出主设备的处理能力。

调整音频缓冲设置。在应用设置中增加缓冲大小，可以提高播放稳定性，但会增加延迟。

确保音频文件格式受支持。应用支持大多数常见的音频格式，但某些特殊格式可能导致播放问题。

## 常见问题

### 功能相关问题

**问：应用支持哪些音频格式？**

答：LAN Music Sync 基于 Android 的 ExoPlayer 引擎，支持大多数常见的音频格式，包括 MP3、AAC、FLAC、OGG、WAV 等。具体支持的格式取决于您的 Android 设备的解码能力。

**问：最多可以连接多少台设备？**

答：理论上应用支持最多 8 台设备同时连接，但实际可连接的设备数量取决于主设备的性能和网络环境。建议在家庭环境中连接 3-5 台设备以获得最佳体验。

**问：音频同步的精度如何？**

答：在理想的网络环境下，应用可以实现 50-100 毫秒的同步精度。这个精度对于大多数使用场景来说是足够的，人耳很难察觉到这种程度的延迟差异。

**问：是否需要互联网连接？**

答：不需要。LAN Music Sync 完全在局域网内工作，不需要互联网连接。只要设备间能够建立 Wi-Fi Direct 连接，就可以正常使用所有功能。

### 技术问题

**问：为什么需要位置权限？**

答：这是 Android 系统的安全要求。使用 Wi-Fi Direct 功能时，系统要求应用必须获得位置权限。应用本身不会收集或使用您的位置信息，这个权限仅用于启用 Wi-Fi Direct 功能。

**问：应用是否会消耗大量电量？**

答：作为主设备时，应用需要持续运行以维持与从设备的连接，会消耗一定的电量。作为从设备时，电量消耗相对较少。建议在长时间使用时为主设备连接电源。

**问：是否支持蓝牙连接？**

答：目前版本不支持蓝牙连接。应用专门设计为使用 Wi-Fi Direct 技术，以提供更高的音频质量和更低的延迟。

**问：能否在不同品牌的设备间使用？**

答：可以。只要设备运行 Android 7.0 或更高版本并支持 Wi-Fi Direct，就可以使用 LAN Music Sync，不受设备品牌限制。

### 使用场景问题

**问：适合在多大的空间内使用？**

答：Wi-Fi Direct 的有效范围通常在 50-100 米左右，但实际范围取决于环境因素如墙壁、干扰等。在典型的家庭或办公环境中，应用可以很好地工作。

**问：是否可以在户外使用？**

答：可以，但需要确保所有设备都在 Wi-Fi Direct 的有效范围内。户外使用时，范围可能会更大，但也要注意电池续航问题。

**问：是否支持播放列表功能？**

答：当前版本支持基本的播放列表功能。您可以在主设备上选择多首歌曲进行连续播放，所有从设备会自动同步播放列表的变化。

## 技术支持

### 获取帮助

如果您在使用过程中遇到本手册未涵盖的问题，可以通过以下方式获取技术支持：

**GitHub Issues**：访问项目的 GitHub 页面，在 Issues 部分提交问题报告。这是获取技术支持的最佳方式，开发团队会及时回复。

**社区论坛**：加入用户社区，与其他用户交流使用经验和解决方案。

**邮件支持**：发送详细的问题描述到技术支持邮箱，包括设备型号、Android 版本、问题重现步骤等信息。

### 反馈和建议

我们非常重视用户的反馈和建议。如果您有功能改进建议或发现了应用的问题，请通过以下方式联系我们：

在 GitHub 上提交 Feature Request，描述您希望添加的功能。

参与用户调研，帮助我们了解用户需求和使用习惯。

分享您的使用体验，帮助其他用户更好地使用应用。

### 版本更新

应用会定期发布更新版本，包含新功能、性能改进和问题修复。建议您：

关注 GitHub Releases 页面，及时了解新版本信息。

启用应用内的更新通知，第一时间获得更新提醒。

在更新前备份重要的设置和数据。

阅读更新日志，了解新版本的变化和改进。

感谢您选择 LAN Music Sync，希望这款应用能为您带来出色的多设备音乐体验！

